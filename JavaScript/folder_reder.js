const fs = require('fs');
const path = require('path');

/**
 * –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–≤–æ–¥–∏—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –≤ –∫–æ–Ω—Å–æ–ª—å —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø–æ –≥–ª—É–±–∏–Ω–µ.
 * @param {string} directoryPath –ü—É—Ç—å –∫ –∫–æ—Ä–Ω–µ–≤–æ–º—É –∫–∞—Ç–∞–ª–æ–≥—É.
 * @param {number} maxDepth –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ (0 –¥–ª—è —Ç–æ–ª—å–∫–æ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞, 1 –¥–ª—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –∏ –µ–≥–æ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–¥–ø–∞–ø–æ–∫, –∏ —Ç.–¥.).
 * @param {number} currentDepth –¢–µ–∫—É—â–∞—è –≥–ª—É–±–∏–Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ (–¥–ª—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤, –Ω–µ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–∑–æ–≤–µ).
 * @param {string} prefix –ü—Ä–µ—Ñ–∏–∫—Å –¥–ª—è –æ—Ç—Å—Ç—É–ø–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª–∏ (–¥–ª—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤, –Ω–µ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–∑–æ–≤–µ).
 */
let directoryPath = './';
let maxDepth = 1;
let currentDepth = 0;

function listDirectoryContents(directoryPath, maxDepth, currentDepth = 0, prefix = '') {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∞ –ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞
    if (currentDepth > maxDepth) {
        return;
    }

    try {
        const items = fs.readdirSync(directoryPath, { withFileTypes: true });

        items.forEach(item => {
            if (item.isDirectory() && ['node_modules', '.git'].includes(item.name)) { 
                return; //  –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–∞–ø–æ–∫ –∏–∑ –ø–æ–∏—Å–∫–∞
            }
            /*
            –í–∫–ª—é—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–∞–ø–∫–∏: –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å if (item.isDirectory() && !['src', 'public'].includes(item.name)) { continue; }, —á—Ç–æ–±—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–∞–ø–∫–∏.
            */
            const fullPath = path.join(directoryPath, item.name);

            if (item.isDirectory()) {
                console.log(`${prefix}üìÅ ${item.name}/`);
                // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤ –¥–ª—è –ø–æ–¥–ø–∞–ø–∫–∏, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≥–ª—É–±–∏–Ω—É
                listDirectoryContents(fullPath, maxDepth, currentDepth + 1, prefix + '  ');
            } else {
                console.log(`${prefix}üìÑ ${item.name}`);
            }
        });
    } catch (error) {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∏–ª–∏ –ø—É—Ç—å –Ω–µ–≤–µ—Ä–µ–Ω
        console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ ${directoryPath}: ${error.message}`);
    }
}

// --- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ ---

// 1. –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –∫–æ—Ä–Ω–µ–≤–æ–º—É –∫–∞—Ç–∞–ª–æ–≥—É, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å
const rootDirectory = './'; // <-- –ò–ó–ú–ï–ù–ò–¢–ï –≠–¢–û–¢ –ü–£–¢–¨ –ù–ê –í–ê–®!

// 2. –£–∫–∞–∂–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≥–ª—É–±–∏–Ω—É —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
// 0: –¢–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã/–ø–∞–ø–∫–∏ –≤ –∫–æ—Ä–Ω–µ–≤–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ.
// 1: –ö–æ—Ä–Ω–µ–≤–æ–π –∫–∞—Ç–∞–ª–æ–≥ –∏ –µ–≥–æ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∞–ø–∫–∏.
// 2: –ö–æ—Ä–Ω–µ–≤–æ–π, –µ–≥–æ –ø–æ–¥–ø–∞–ø–∫–∏ –∏ –ø–æ–¥–ø–∞–ø–∫–∏ –≤–Ω—É—Ç—Ä–∏ —ç—Ç–∏—Ö –ø–æ–¥–ø–∞–ø–æ–∫.
// –ò —Ç.–¥.
const scanDepth = 2; // <-- –ò–ó–ú–ï–ù–ò–¢–ï –≠–¢–£ –ì–õ–£–ë–ò–ù–£ –ü–û –ù–ï–û–ë–•–û–î–ò–ú–û–°–¢–ò

console.log(`–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞: ${rootDirectory} (–ì–ª—É–±–∏–Ω–∞: ${scanDepth})\n`);
listDirectoryContents(rootDirectory, scanDepth);